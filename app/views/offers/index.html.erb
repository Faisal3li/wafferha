
<% @offers.each do |offer| %>
    <div class="row">
        <div class="col s4">

            <div class="card">
                <div class="card-image waves-effect waves-block waves-light">
                    <%= cl_image_tag offer.image %>
                </div>
                <div class="card-content">
                    <span class="card-title activator grey-text text-darken-4 "><%= link_to offer.company.name, company_path(offer.company),class:"companyCard" %><i class="small material-icons right arrow" data-id="<%=offer.id %>">arrow_drop_up</i></span>
                    <p class="paraCard"> Offer starts: <%= offer.start_Date %></p>
                    <p class="paraCard"> Offer Expires: <%= offer.expired_Date %></p>
                </div>
                <div class="card-action">
                 <%= link_to "Read more", offer_path(offer) %>
                 <p id="offer-<%= offer.id%>"> Views: <%= offer.views.length %></p>
                 
                </div>
                <div class="card-reveal upCard">
                        <span class="card-title grey-text text-darken-4"><%= offer.company.name %><i class="small material-icons right">close</i></span>
                        <p class="concertFont"><%= offer.offer_Description %></p>
                        <p class="paraCard"> Offer starts: <%= offer.start_Date %></p>
                        <p class="paraCard"> Offer Expires: <%= offer.expired_Date %></p> 
                </div>
                
            </div>
        </div>
    </div>
<% end %>

<%#= link_to("Read more!", offer_path(offer)) %>
<% if user_signed_in? && current_user.premium %>
    <% @offers.each do |item| %>
        <% if item.coupon  %>
            <%= cl_image_tag item.image%>
            <p> <%= link_to item.company.name, offer_path(item) %> </p>
        <% end %>
    <% end%>
<% end%>

<% if user_signed_in? && current_user.premium %>
    <% @offers.each do |item| %>
        <% if item.coupon  %>
            <%= cl_image_tag item.image%>
            <p> <%= link_to item.company.name, offer_path(item.company) %> </p>
        <% end%>
    <% end %>
    <% else  %>
    <%# redirect_to new_user_session_path %>
<% end %>

<% if user_signed_in? %>
    <script>
        $(".arrow").on("click", function blah(e)  {
             // console.log("clicked", e.target);
            //const offerID = e.target.getAttribute("data-id");
            const offer_id = e.target.getAttribute("data-id");
            const params = {offer_id: offer_id}

                // console.log(params)
           // const length = offer.views.length;
            //console.log(length)
             fetch('/views', { 
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                    Accept: "application/json"
                },
                body: JSON.stringify(params) 
            })
            .then(resp => resp.json())
            .then(data => { 
               console.log(data.offer.view.length);
                const ul = document.querySelector(`#offer-${data.offer_id}`);
                const html = "Views: " ;
                ul.innerHTML = html;
            })
           
        });
        // When someone clicks the arrow, get the offer_id (maybe using the data-id attribute - getAttribute("data-id");)
        // Then, make an AJAX request (POST to "/views" - offer_id, user_id)
        // When the data comes back, change the text after views to the new count of views
    </script>
<% end %>